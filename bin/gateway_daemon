#!/usr/bin/env ruby

require 'daemons'
PID_PATH = File.expand_path('../../tmp/pids', __FILE__)
ENV_PATH = File.expand_path('../../config/environment.rb', __FILE__)

options = {
  dir_mode: :normal,
  dir: PID_PATH
}

Daemons.run_proc('gateway_daemon', options) do
  require ENV_PATH

  interval = Setting.get('metadata_pull_interval') || 600

  loop do
    puts 'Starting update...'
    Setting.api_update
    puts 'Finished updating'
    sleep interval
  end
end
